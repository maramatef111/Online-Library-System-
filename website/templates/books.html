{% extends 'base.html' %}
{% block title %}Books{% endblock %}
{% block content %}
<h2>Books</h2>
<form class="row g-2 mb-3" method="get">
<div class="col-auto">
<input type="text" name="q" class="form-control" placeholder="Search by title or author" value="{{ q }}">
</div>
<div class="col-auto">
<button class="btn btn-primary" type="submit">Search</button>
<a class="btn btn-outline-secondary" href="{{ url_for('views.books') }}">Clear</a>
</div>
</form>


<table class="table table-striped">
<thead><tr><th>Title</th><th>Author</th><th>Stock</th><th>Action</th></tr></thead>
<tbody>
{% for book in books %}
<tr>
<td>{{ book.title }}</td>
<td>{{ book.author }}</td>
<td>{{ book.stock }}</td>
<td>
{% if book.stock > 0 %}
<form method="post" action="{{ url_for('views.books') }}" style="display:inline;">
<input type="hidden" name="book_id" value="{{ book.id }}">
<button class="btn btn-success btn-sm">Borrow (web)</button>
</form>
<!-- Borrow via AJAX / API could be done using JWT -->
{% else %}
<button class="btn btn-secondary btn-sm" disabled>Unavailable</button>
{% endif %}
{% if user.is_admin %}
<a class="btn btn-warning btn-sm" href="{{ url_for('views.admin_edit_book', id=book.id) }}">Edit</a>
<form method="post" action="{{ url_for('views.admin_delete_book', id=book.id) }}" style="display:inline;" onsubmit="return confirm('Delete this book?');">
<button class="btn btn-danger btn-sm">Delete</button>
</form>
{% endif %}
</td>
</tr>
{% else %}
<tr><td colspan="4">No books found.</td></tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
